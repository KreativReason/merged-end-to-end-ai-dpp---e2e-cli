{
  "artifact_type": "adr",
  "scope": "mothership",
  "status": "complete",
  "validation": "passed",
  "approval_required": false,
  "next_phase": "implementation",
  "data": {
    "project_name": "End-to-End Agentic Development Pipeline",
    "version": "1.0.0",
    "adr_file_content": "# Architecture Decision Records (ADRs)\n\n## Protocol Information\n- **Version**: 1.0\n- **ID Format**: ADR-XXXX (4-digit zero-padded)\n- **Status Values**: Proposed | Accepted | Rejected | Deprecated | Superseded\n- **Anchor Format**: `<a id=\"adr-XXXX\"></a>`\n- **Sort Order**: ID descending (newest on top)\n\n## Index\n\n| ID | Decision | Date | Status | Supersedes | Superseded By |\n|---|---|---|---|---|---|\n| [ADR-0012](#adr-0012) | [Migration Agent and Project Update Protocol](#adr-0012) | 2025-10-16 | Accepted | ‚Äî | ‚Äî |\n| [ADR-0011](#adr-0011) | [Agent System Template Implementation (SCAFFOLD-012)](#adr-0011) | 2025-10-16 | Accepted | ‚Äî | ‚Äî |\n| [ADR-0010](#adr-0010) | [ADR Separation Architecture (Mothership vs Project)](#adr-0010) | 2025-10-16 | Accepted | ‚Äî | ‚Äî |\n| [ADR-0004](#adr-0004) | [Beta Testing Improvements and Production Readiness](#adr-0004) | 2025-10-12 | Accepted | ‚Äî | ‚Äî |\n| [ADR-0003](#adr-0003) | [Agent Inheritance and Project Lifecycle Management](#adr-0003) | 2024-09-12 | Accepted | ‚Äî | ‚Äî |\n| [ADR-0002](#adr-0002) | [Two-Stage Scaffolding Architecture](#adr-0002) | 2024-09-12 | Accepted | ‚Äî | ‚Äî |\n| [ADR-0001](#adr-0001) | [Meta-Development Project Factory System](#adr-0001) | 2024-09-12 | Accepted | ‚Äî | ‚Äî |\n---\n\n<a id=\"adr-0012\"></a>\n## ADR-0012 ‚Äî Migration Agent and Project Update Protocol\n\n**Date**: 2025-10-16\n**Status**: Accepted\n**Context**: After manually fixing generated project (file placements, adding agent system), user identified critical gap: fixes not logged in mothership, no agent for managing updates.\n\n### Problem\nThe pipeline had several critical gaps in project lifecycle management:\n1. **No Update Management**: Scaffolder.agent manages initial generation only, no agent for updating/migrating already-generated projects\n2. **Lost Improvements**: Manual fixes to generated projects not reflected back in mothership\n3. **No Change Tracking**: No changelog tracking mothership improvements over time\n4. **Template Inconsistency**: Templates created ad-hoc without standardization or central location\n5. **No Synchronization**: Generated projects had no way to receive mothership template updates\n\n### Decision\nImplement **Migration.agent.md** with comprehensive update and synchronization responsibilities:\n\n#### Agent Responsibilities\n- **Update Management**: Manage updates to already-generated projects\n- **Template Propagation**: Apply mothership template updates to existing projects\n- **Breaking Changes**: Handle breaking changes with migration scripts\n- **Structure Validation**: Validate project structure compliance with latest templates\n- **Status Reporting**: Report sync status back to mothership\n- **Template Enforcement**: Enforce template standards (all templates in templates/ directory)\n\n#### Update Protocol\nStandardized workflow for project updates:\n1. **Check for updates**: `make mothership-sync --check`\n2. **Preview changes**: `make mothership-sync --preview`\n3. **Apply updates**: `make mothership-sync --apply`\n4. **Review changelog**: `mothership/CHANGELOG.md`\n\n#### Approval Gate\n- **Approvers**: Cynthia (Project Manager) + Usama (Lead Developer)\n- **Criteria**: Same approval standards as Scaffolder.agent\n- **Review Focus**: Breaking changes, migration script safety, backward compatibility\n\n### Consequences\n\n#### Positive\n- **Synchronized Projects**: Projects stay synchronized with mothership improvements\n- **Improvement Propagation**: Template fixes and enhancements propagate to all projects\n- **Clear Update Path**: Standardized workflow for receiving mothership updates\n- **Change Visibility**: CHANGELOG.md provides transparent history of mothership evolution\n- **Template Standardization**: Enforces consistent template organization\n- **Audit Trail**: All updates tracked and reviewable\n\n#### Negative\n- **Added Complexity**: Introduces synchronization layer between mothership and projects\n- **Migration Scripts**: Requires development and testing of migration scripts\n- **Version Conflicts**: Need to manage potential conflicts between mothership and project customizations\n- **Maintenance Overhead**: CHANGELOG.md requires ongoing maintenance\n- **Breaking Changes**: Must carefully manage backward compatibility\n\n### Implementation\n- **Create**: `agents/Migration.agent.md` with update management responsibilities\n- **Create**: `CHANGELOG.md` in mothership root directory\n- **Add**: Make targets for `mothership-sync` operations\n- **Add**: Version tracking in `mothership/connection.json`\n- **Add**: Migration script framework in `scripts/migrations/`\n\n### Related Decisions\n- **ADR-0002**: Two-Stage Scaffolding Architecture (extends with update management)\n- **ADR-0003**: Agent Inheritance and Project Lifecycle Management (completes lifecycle)\n- **ADR-0011**: Agent System Template Implementation (needs update propagation)\n\n### Success Metrics\n- Generated projects can receive mothership template updates\n- CHANGELOG.md tracks all mothership improvements\n- Migration scripts handle breaking changes gracefully\n- Projects can opt-in to specific update versions\n- Sync status visible in project health dashboard\n\n### Technology Stack Impact\n- **Make**: New targets for sync operations\n- **Migration Scripts**: Python-based migration framework\n- **Version Management**: Semantic versioning for templates\n- **Change Tracking**: Markdown-based changelog\n\n---\n\n<a id=\"adr-0011\"></a>\n## ADR-0011 ‚Äî Agent System Template Implementation (SCAFFOLD-012)\n\n**Date**: 2025-10-16\n**Status**: Accepted\n**Context**: During Richtungswechsel ROI Tracker generation, discovered that scaffold plan was missing SCAFFOLD-012 template for project-specific agent system as required by ADR-0003.\n\n### Problem\nThe scaffolding process had a critical gap:\n1. **Missing Template**: Scaffold plan lacked SCAFFOLD-012 for agent system setup\n2. **No Agent Directory**: Generated projects had no `agents/` directory\n3. **No Cursor Rules**: Missing `.cursorrules` file for AI behavior configuration\n4. **No Mothership Connection**: Missing `mothership/` directory and connection metadata\n5. **Violated ADR-0003**: Projects weren't autonomous development environments per Agent Inheritance architecture\n\n### Decision\nCreate **SCAFFOLD-012** template package with 7 essential files for project-specific agent system:\n\n#### Template Files\n\n1. **agents/_common.guardrails.md**\n   - Shared rules across all project agents\n   - JSON-only output enforcement\n   - German field name requirements\n   - Multi-tenancy patterns\n   - Context loading protocols\n\n2. **agents/Feature.agent.md**\n   - Agent for adding new features\n   - Validates against PRD requirements\n   - German requirement documentation\n   - Feature specification workflow\n\n3. **agents/Coding.agent.md**\n   - Agent for implementation work\n   - TypeScript best practices\n   - Firebase integration patterns\n   - Testing requirements (unit, integration, e2e)\n   - Formula preservation rules\n\n4. **agents/Bugfix.agent.md**\n   - Agent for bug fixes\n   - Bug categories and severity levels\n   - Root cause analysis workflow\n   - Regression prevention\n\n5. **.cursorrules**\n   - AI behavior configuration\n   - Critical rules marked NON-NEGOTIABLE\n   - Project-specific coding standards\n   - Tool usage guidelines\n\n6. **mothership/connection.json**\n   - Umbilical cord connection metadata\n   - Mothership URL and version\n   - Sync configuration\n   - Generated project identifier\n\n7. **mothership/README.md**\n   - Connection documentation\n   - Update protocol instructions\n   - Mothership relationship explanation\n\n#### Template Storage\n- **Location**: `templates/agents/project-specific/`\n- **Format**: Markdown files with YAML frontmatter\n- **Customization**: Templates support variable substitution for project-specific values\n\n### Consequences\n\n#### Positive\n- **Autonomous Projects**: Generated projects now autonomous development environments per ADR-0003\n- **Consistent Agent Behavior**: All projects have standardized agent system\n- **Mothership Connection**: Umbilical cord architecture implemented\n- **German Support**: Built-in support for German requirement documentation\n- **Complete Scaffolding**: No manual setup required after generation\n\n#### Negative\n- **Revealed Update Gap**: Exposed lack of update management (addressed by ADR-0012)\n- **Template Maintenance**: 7 additional files to maintain in template library\n- **Increased Complexity**: Scaffolder must handle more file generation\n\n### Implementation Notes\n- **Created**: 7 template files in `templates/agents/project-specific/`\n- **Updated**: Scaffolder.agent.md to include SCAFFOLD-012 in plan\n- **Validated**: Templates tested on Richtungswechsel ROI Tracker project\n- **Variables**: Support for `{{PROJECT_NAME}}`, `{{MOTHERSHIP_VERSION}}`, etc.\n\n### Related Decisions\n- **ADR-0003**: Agent Inheritance and Project Lifecycle Management (implements this architecture)\n- **ADR-0002**: Two-Stage Scaffolding Architecture (extends scaffolding templates)\n- **ADR-0012**: Migration Agent and Project Update Protocol (manages template updates)\n\n### Success Metrics\n- All generated projects include complete agent system\n- Projects have functional `.cursorrules` file\n- Mothership connection established automatically\n- Agents validate against PRD and maintain German documentation\n- No manual agent setup required post-generation\n\n### Technology Stack Impact\n- **Template System**: Extended with 7 new template files\n- **Scaffolder**: Updated to process agent system templates\n- **Project Structure**: Standardized `agents/` and `mothership/` directories\n- **AI Behavior**: Consistent `.cursorrules` across all projects\n\n---\n\n<a id=\"adr-0010\"></a>\n## ADR-0010 ‚Äî ADR Separation Architecture (Mothership vs Project)\n\n**Date**: 2025-10-16\n**Status**: Accepted\n**Context**: During the Richtungswechsel ROI Tracker project, a conflict emerged between mothership ADRs (pipeline architecture decisions) and project ADRs (application-specific decisions). Both files used overlapping IDs (ADR-0001 to ADR-0004), creating ambiguity for downstream agents like the Scaffolder.\n\n### Problem\nThe pipeline generates two types of architectural decisions:\n1. **Mothership ADRs**: Framework/pipeline decisions (e.g., ADR-0001: Meta-Development Project Factory System)\n2. **Project ADRs**: Application-specific technology decisions (e.g., ADR-0001: Use Clerk for Authentication)\n\nInitial implementation stored these in separate files (`docs/adr.json` and `docs/adr-project.json`) with conflicting ID namespaces, causing:\n- **ID Conflicts**: Both files had ADR-0001, ADR-0002, etc.\n- **Unclear Inheritance**: Scaffolder wouldn't know which ADRs to copy to generated projects\n- **Poor Separation**: No clear boundary between inherited (read-only) and project-specific (mutable) decisions\n- **Scalability Issues**: Pattern wouldn't scale to multi-layer project inheritance\n\n### Decision\nImplement **Approach B: Directory-Based ADR Separation** with the following structure:\n\n```\ndocs/adr/\n  mothership.json    ‚Üê Pipeline/framework ADRs (read-only, inherited)\n  project.json       ‚Üê Application-specific ADRs (mutable)\n  README.md          ‚Üê Documentation of the pattern\n```\n\n#### Key Design Principles:\n1. **Independent ID Namespaces**: Each file has its own ADR-0001, ADR-0002, etc.\n2. **Scope Metadata**: `scope: \"mothership\"` vs `scope: \"project\"` field distinguishes files\n3. **File-Based Boundaries**: File name explicitly shows which ADRs are inherited vs project-specific\n4. **Read-Only Mothership**: Mothership ADRs are reference documentation, never modified by generated projects\n5. **Dual Format Support**: Mothership uses markdown format (adr_file_content), projects use structured JSON (decisions array)\n\n#### Pydantic Model Updates:\nUpdated `ADRModel` and `ADRData` to support both formats:\n- Added `scope` field: `\"mothership\" | \"project\"`\n- Made `decisions` optional (for markdown format)\n- Added `adr_file_content`, `decisions_added`, `index_entries` (for markdown format)\n- Validator ensures at least one format is present\n\n### Alternatives Considered\n\n#### Alternative A: Merge with Scope Metadata\n- Single `docs/adr.json` with `scope` field on each decision\n- Scaffolder splits during project generation\n- **Rejected**: Mixed concerns in one file, not self-documenting, requires metadata parsing\n\n#### Alternative C: Namespace IDs\n- Use prefixed IDs: ADR-PIPE-0001, ADR-PROJ-0001\n- **Rejected**: Breaking change to ID format, violates stable ID conventions (ADR-XXXX), requires Pydantic changes\n\n#### Alternative D: Status Quo (Keep Conflicting Files)\n- Leave `docs/adr.json` and `docs/adr-project.json` as-is\n- **Rejected**: Scaffolder can't distinguish which ADRs to inherit, ID conflicts unresolved\n\n### Rationale\nApproach B was selected as the \"most professional approach\" for these reasons:\n\n1. **Industry Pattern**: Mirrors established patterns like `node_modules/` (inherited) vs `src/` (mutable)\n2. **Explicit Boundaries**: File name clearly shows inheritance scope\n3. **Separation of Concerns**: Mothership decisions isolated from project decisions\n4. **Better Safety**: File permissions can enforce read-only mothership (future)\n5. **Scalable**: Supports multi-layer inheritance (project ‚Üí sub-project)\n6. **Self-Documenting**: Directory structure explains architecture without reading metadata\n\n### Consequences\n\n#### Positive\n- **No ID Conflicts**: Independent namespaces eliminate ambiguity\n- **Clear Inheritance Model**: Scaffolder knows to copy mothership.json as read-only reference\n- **Better Organization**: Related ADRs grouped by scope\n- **Future-Proof**: Pattern scales to complex project hierarchies\n- **Dual Format Support**: Accommodates both markdown (mothership) and JSON (project) formats\n- **Improved Developer Experience**: Clear mental model of inherited vs custom decisions\n\n#### Negative\n- **Agent Updates Required**: ADR.agent.md and Scaffolder.agent.md need updates (~2 hours)\n- **Documentation Overhead**: Must document pattern for future developers\n- **Breaking Change**: Existing projects using single adr.json need migration\n- **Two File Reads**: Agents must load both files instead of one\n\n#### Risks\n- **Migration Errors**: Existing pipeline projects need careful migration (mitigation: validation script)\n- **Confusion**: Developers may not understand why two files exist (mitigation: README.md in docs/adr/)\n- **Inconsistency**: Future agents might violate pattern (mitigation: update _common.guardrails.md)\n\n### Implementation Notes\n- Files created: `docs/adr/mothership.json`, `docs/adr/project.json`\n- Model updated: `app/models.py` (ADRModel, ADRData, DecisionMetadata, IndexEntry)\n- Validation: Both files pass Pydantic validation\n- Format: Mothership uses markdown, project uses structured JSON\n- Scope field: Required for all future ADR artifacts\n\n### Next Steps\n1. Update `agents/ADR.agent.md` to generate files in `docs/adr/` directory\n2. Update `agents/Scaffolder.agent.md` to copy mothership ADRs as read-only reference\n3. Create `docs/adr/README.md` explaining the pattern\n4. Update `_common.guardrails.md` to document directory structure\n5. Add validation checks to ensure scope field is always present\n\n### Success Metrics\n- ‚úÖ No ID conflicts between mothership and project ADRs\n- ‚úÖ Both files validate against updated Pydantic model\n- ‚úÖ Clear separation of concerns (inherited vs custom)\n- üîÑ Scaffolder copies mothership ADRs correctly (pending implementation)\n- üîÑ Generated projects maintain pattern (pending validation)\n\n### Related Decisions\n- ADR-0003: Agent Inheritance and Project Lifecycle Management\n- ADR-0004: Beta Testing Improvements and Production Readiness\n\n### Technology Stack Impact\n- **Pydantic Models**: Updated to support dual-format ADRs\n- **File Structure**: New `docs/adr/` directory with multiple JSON files\n- **Agent Behavior**: ADR and Scaffolder agents require updates\n\n\n<a id=\"adr-0004\"></a>\n## ADR-0004 ‚Äî Beta Testing Improvements and Production Readiness\n\n**Date**: 2025-10-12\n**Status**: Accepted\n**Context**: After beta testing the mothership pipeline on the Nonna Call Center Voice Agent AI project, critical production issues were identified and resolved.\n\n### Problem\nBeta testing revealed several blockers preventing production use:\n1. **Token Limits**: Large flow artifacts (149 steps) exceeded chat output limits\n2. **Pydantic Errors**: Using deprecated Pydantic 1.x syntax causing validation failures\n3. **Directory Pollution**: Scaffolding creating files in pipeline project instead of separate directory\n4. **Missing Implementation Agent**: No agent for actual code implementation after planning\n5. **Inconsistent AI Behavior**: Agents not following consistent rules across sessions\n6. **Role Ambiguity**: Team role assignments unclear and inconsistent across documentation\n\n### Decision\nImplement comprehensive improvements based on real-world usage:\n\n#### 1. Token-Safe Flow Agent (File-First Architecture)\n**Problem**: Flow artifacts with 11 user flows + 8 system flows (149 total steps) exceeded terminal output limits.\n\n**Solution**: Redesigned Flow.agent.md with sharding approach:\n- Writes one JSON file per flow: `docs/flows/user/FLOW-001.json`, `docs/flows/system/SFLOW-001.json`\n- Only prints file paths to chat, never full JSON payloads\n- Creates merged `final_flow.json` for validation\n- Returns compact manifest (‚â§1k tokens)\n- Unlimited artifact size on disk, minimal chat output\n\n**Impact**: Eliminated token limit issues entirely. Flow size now unlimited.\n\n#### 2. Pydantic 2.0 Migration\n**Problem**: Using `regex=` and `@validator` from Pydantic 1.x caused validation errors.\n\n**Solution**: Updated `app/models.py` for Pydantic 2.0 compatibility:\n- Changed `regex=` ‚Üí `pattern=` for all Field validators (40+ instances)\n- Changed `@validator` ‚Üí `@field_validator` with `mode='after'`\n- Updated import: `from pydantic import field_validator`\n\n**Impact**: Zero validation errors. Full Pydantic 2.0 compatibility.\n\n#### 3. Scaffolder Directory Separation\n**Problem**: Scaffolding script created files in pipeline directory, polluting the factory.\n\n**Solution**: Created `scripts/scaffold_apply.py` with:\n- `--project-dir` argument (default: `../generated-projects/{project-name}/`)\n- Enforcement of separate directory structure\n- Pydantic validation of PRD/ERD/Plan inputs\n- Human approval gate enforcement (Cynthia + Usama)\n- Placeholder file generation for all file types (py, ts, sql, json, md)\n\n**Impact**: Fixed factory pattern. Mothership stays clean, products separate.\n\n#### 4. Coding Agent for Implementation\n**Problem**: Pipeline ended at task planning with no implementation guidance.\n\n**Solution**: Added `agents/Coding.agent.md` with:\n- Definition of Done checklist\n- Test coverage requirements (unit, integration, e2e)\n- Security checklist\n- Performance metrics tracking\n- Approval gate: Mustaffa (QA) + Usama (Lead Developer)\n- Complete implementation output schema\n\n**Impact**: Pipeline now end-to-end from transcript to implemented code.\n\n#### 5. .cursorrules for Consistent Behavior\n**Problem**: Agents had inconsistent behavior across sessions and projects.\n\n**Solution**: Created `.cursorrules` file enforcing:\n- JSON-only output for artifacts\n- Stable ID management (FR-###, ST-###, etc.)\n- Context loading before acting\n- Human approval gate respect\n- Pydantic validation requirements\n\n**Impact**: Consistent, predictable agent behavior across all sessions.\n\n#### 6. Role Clarification\n**Problem**: Team roles inconsistent across README, agents, and approval gates.\n\n**Solution**: Standardized roles across all documentation:\n- **Cynthia**: Project & Operations Manager\n- **Hermann**: Product Owner & Orchestrator\n- **Usama**: Lead Developer\n- **Hassan**: Developer\n- **Dawood**: Developer\n- **Mustaffa**: QA Engineer\n\n**Impact**: Clear accountability and approval authority.\n\n### Alternatives Considered\n1. **Continue with token workarounds**: Would limit artifact complexity\n2. **Stay on Pydantic 1.x**: Would block modern features and support\n3. **Manual directory management**: Error-prone and inconsistent\n4. **Skip implementation agent**: Would leave pipeline incomplete\n\n### Consequences\n#### Positive\n- **Production-Ready**: All beta test blockers resolved\n- **Scalable**: Unlimited artifact sizes supported\n- **Reliable**: Consistent validation and behavior\n- **Complete**: End-to-end from transcript to code\n- **Maintainable**: Modern dependencies and clear patterns\n- **Auditable**: Clear roles and approval gates\n\n#### Negative\n- **Migration Cost**: Existing projects need updates for compatibility\n- **Learning Curve**: New file-first patterns require documentation\n- **Disk Usage**: Large artifacts now stored as multiple files\n\n### Validation Results\nTested on Nonna Call Center Voice Agent AI (real production project):\n- ‚úÖ Generated 20 entities, 23 relationships (ERD)\n- ‚úÖ Created 11 user flows + 8 system flows (149 total steps)\n- ‚úÖ Produced complete PRD (57KB), Flow (comprehensive), ERD, Tasks\n- ‚úÖ All Pydantic validation passed\n- ‚úÖ Scaffolding created project in correct directory\n- ‚úÖ Zero token limit errors\n- ‚úÖ Agents followed rules consistently\n\n### Implementation Notes\n- Updated files: `agents/Flow.agent.md`, `agents/Coding.agent.md`, `app/models.py`, `.cursorrules`, `scripts/scaffold_apply.py`, `Makefile`, `README.md`\n- All improvements backward-compatible except Pydantic migration\n- Role updates applied to all approval gates\n- Beta project used as validation: `Agentic-Product-Factory` on GitHub\n\n### Success Metrics\n- Time from client transcript to deployable repository: **< 1 day** ‚úÖ\n- Token limit errors: **0** ‚úÖ\n- Pydantic validation errors: **0** ‚úÖ\n- Scaffolding directory issues: **0** ‚úÖ\n- Agent consistency: **100%** ‚úÖ\n\n### Technology Stack Impact\n- **Pydantic**: Upgraded to 2.x (breaking change, migration required)\n- **Python**: Requires 3.9+ (for Pydantic 2.0)\n- **File Storage**: Artifacts now use sharded multi-file approach\n- **Agent Behavior**: Governed by `.cursorrules` file\n\n---\n\n<a id=\"adr-0003\"></a>\n## ADR-0003 ‚Äî Agent Inheritance and Project Lifecycle Management\n\n**Date**: 2024-09-12\n**Status**: Accepted\n**Context**: Generated projects need to be autonomous development environments while maintaining connection to the mothership pipeline.\n\n### Problem\nEach generated project repository must:\n- Function as a standalone development environment\n- Have project-specific AI agents and rules\n- Maintain connection to mothership for updates and reporting\n- Support its own feature development pipeline\n- Report progress back to Linear project management\n\n### Decision\nImplement a **Genetic Information Architecture** where each generated project inherits:\n\n#### 1. Project-Specific Agent System\n- Custom `.cursor/rules/` directory with project-specific workflow rules\n- Specialized agents in `agents/` directory tailored to project domain\n- Project-specific task templates for feature development\n- Custom guardrails reflecting project constraints and patterns\n\n#### 2. Umbilical Cord Architecture\n- Each project maintains `mothership/` directory with:\n  - Connection configuration to parent pipeline\n  - Progress reporting mechanism to Linear\n  - Update synchronization from parent templates\n  - ADR inheritance from parent decisions\n\n#### 3. Self-Replicating Capability\n- Generated projects can spawn sub-agents for feature development\n- Simplified pipeline for adding new features/modules\n- Ability to request updates from mothership when needed\n\n### Consequences\n#### Positive\n- Each project becomes autonomous development shop\n- Maintains consistency with parent architecture\n- Enables distributed development across multiple projects\n- Scales development capacity through specialization\n\n#### Negative\n- Complexity in maintaining synchronization\n- Potential versioning conflicts between parent and child\n- Requires robust update propagation mechanism\n\n### Implementation Notes\n- Mothership maintains `projects/` directory with all generated repos\n- Each project reports status via ADR updates to mothership\n- Linear integration tracks all projects from single mothership location\n\n---\n\n<a id=\"adr-0002\"></a>\n## ADR-0002 ‚Äî Two-Stage Scaffolding Architecture\n\n**Date**: 2024-09-12\n**Status**: Accepted\n**Context**: Need secure, human-approved scaffolding process that generates complete project repositories.\n\n### Problem\nScaffolding must be both automated and controlled:\n- Generate complete project repositories from PRD requirements\n- Ensure human approval before expensive generation operations\n- Support multiple project templates (NextJS+Firebase, FastAPI+PostgreSQL, etc.)\n- Create working boilerplate implementations, not just skeleton files\n\n### Decision\nImplement **Two-Stage Scaffolding System** following GPT setup instructions:\n\n#### Stage 1: Planning Agent (Suggestion Only)\n- **Input**: PRD + feature selections + technology preferences\n- **Output**: Detailed JSON plan with file structure, dependencies, implementations\n- **Constraints**: Cannot write files, only generates plans\n- **Approval Gate**: Cynthia + Usama review and approve plan\n\n#### Stage 2: Build Agent (Execution Only)\n- **Input**: Approved plan from Stage 1\n- **Output**: Complete project repository in separate directory\n- **Capabilities**: Creates files, installs dependencies, configures environments\n- **Result**: Ready-to-push GitHub repository\n\n### Alternatives Considered\n1. **Single-stage automated**: Too risky, no human control\n2. **Manual scaffolding**: Too slow, inconsistent results\n3. **Template copying only**: Insufficient customization\n\n### Consequences\n#### Positive\n- Human oversight prevents expensive mistakes\n- Plans can be reviewed and modified before execution\n- Clear separation of concerns (planning vs execution)\n- Auditable process with approval gates\n\n#### Negative\n- Adds approval step to pipeline\n- Requires coordination between multiple agents\n- Potential delay if approvers unavailable\n\n### Implementation Notes\n- Stage 1: `make scaffold-plan` ‚Üí human approval ‚Üí Stage 2: `make scaffold-apply`\n- Plans stored in JSON format for programmatic processing\n- Build stage creates complete directory structure in `../generated-projects/`\n\n---\n\n<a id=\"adr-0001\"></a>\n## ADR-0001 ‚Äî Meta-Development Project Factory System\n\n**Date**: 2024-09-12\n**Status**: Accepted\n**Context**: Need to transform client requirements into complete, production-ready development environments.\n\n### Problem\nClient onboarding requires significant manual work to:\n- Analyze requirements and create technical specifications\n- Set up project repositories with appropriate architecture\n- Configure development environments and tooling\n- Create project-specific documentation and workflows\n- Establish development team processes\n\n### Decision\nBuild an **End-to-End Agentic Development Pipeline** that serves as a **Project Factory System**:\n\n#### Core Pipeline Flow\n```\nClient Transcript ‚Üí PRD ‚Üí Flow ‚Üí ERD ‚Üí Journey ‚Üí Tasks ‚Üí ADR ‚Üí Scaffolded Project\n```\n\n#### Human Approval Gates\n- PRD validation: Cynthia (Project & Ops Manager) + Hermann (Product Owner) + Usama (Lead Developer)\n- Scaffolder plan: Cynthia + Usama  \n- ERD + validation: Cynthia + Hassan (Developer) + Usama\n- Task breakdown: Cynthia + Hermann + Usama\n- Code merge: Mustaffa (QA) + Usama\n\n#### Output: Complete Development Ecosystems\nEach generated project includes:\n- **Working Application Code**: CRUD operations, authentication, database setup\n- **Custom AI Agents**: Project-specific `.cursor/rules` and agent definitions\n- **Development Infrastructure**: Testing, linting, CI/CD configuration\n- **Documentation**: PRD, ADR, API docs, setup instructions\n- **Project Management Integration**: Linear sync, task tracking\n\n### Reference Architecture\nUsing `nextjs-firebase-ai-coding-template` as reference implementation showing:\n- Event-driven broker architecture with Firebase\n- AI-optimized development workflow\n- Distributed cursor rules system\n- Integration testing philosophy\n- Real-time database-as-truth pattern\n\n### Alternatives Considered\n1. **Manual project setup**: Too slow, inconsistent\n2. **Simple template copying**: Insufficient customization\n3. **Specification-only output**: Doesn't solve implementation bottleneck\n4. **Single-template approach**: Limited to one architecture pattern\n\n### Consequences\n#### Positive\n- Transforms weeks of setup into hours of generation\n- Ensures consistent architecture patterns across projects\n- Scales development capacity through automation\n- Reduces human error in project initialization\n- Creates autonomous development environments\n\n#### Negative\n- High complexity in template system\n- Requires maintenance of multiple project templates\n- Risk of over-engineering for simple projects\n- Dependency on approval chain for project generation\n\n### Success Metrics\n- Time from client transcript to deployable repository < 1 day\n- Generated projects require minimal manual configuration\n- Development teams can immediately begin feature work\n- Consistent architecture patterns across all generated projects\n\n### Implementation Status (as of 2025-10-12)\n‚úÖ **Completed:**\n- Core agent system (9 specialized agents including Coding agent)\n- Two-stage scaffolding architecture with script execution\n- Human approval gate system\n- Enhanced ADR protocol with self-management\n- Integration testing framework\n- Enhanced task templates with context planning\n- Validation utilities (PRD linter, ERD linter)\n- Token-safe flow generation (file-first sharding)\n- Pydantic 2.0 migration\n- Consistent AI behavior via .cursorrules\n- Production-tested on Nonna Call Center Voice Agent AI\n\nüîÑ **In Progress:**\n- Template library (NextJS+Firebase, FastAPI+PostgreSQL, React Native+Firebase, ChatBot+LangChain)\n- Mothership project management structure\n- Linear integration for task synchronization\n\nüìã **Planned:**\n- Agent inheritance implementation\n- Boilerplate CRUD/Auth implementations\n- Project lifecycle management\n- Update propagation from mothership to projects\n\n### Technology Stack Decisions\n#### Supported Project Types (Priority Order)\n1. **SaaS Applications**: NextJS + Firebase/Supabase\n2. **API Services**: FastAPI + PostgreSQL  \n3. **Chatbots**: Python + LangChain + Vector DB\n4. **Mobile Apps**: React Native + Firebase\n5. **E-commerce**: NextJS + Stripe + PostgreSQL (future)\n\n#### Template Selection Criteria\n- ADR agent makes technology decisions based on PRD requirements\n- Client preferences specified in transcript\n- Preset \"recipes\" for common use cases\n- Capability to combine templates for complex architectures\n\n---\n\n## Next Steps\n1. Test end-to-end pipeline with additional projects\n2. Build template library with working CRUD/Auth implementations\n3. Implement agent inheritance system\n4. Complete mothership project management structure\n5. Deploy multiple generated projects to validate scalability",
    "protocol_version": "1.0",
    "decisions_added": [
      {
        "id": "ADR-0012",
        "title": "Migration Agent and Project Update Protocol",
        "status": "accepted",
        "anchor_id": "adr-0012",
        "index_updated": true
      },
      {
        "id": "ADR-0011",
        "title": "Agent System Template Implementation (SCAFFOLD-012)",
        "status": "accepted",
        "anchor_id": "adr-0011",
        "index_updated": true
      },
      {
        "id": "ADR-0010",
        "title": "ADR Separation Architecture (Mothership vs Project)",
        "status": "accepted",
        "anchor_id": "adr-0010",
        "index_updated": true
      },
      {
        "id": "ADR-0001",
        "title": "Meta-Development Project Factory System",
        "status": "accepted",
        "anchor_id": "adr-0001",
        "index_updated": true
      },
      {
        "id": "ADR-0002",
        "title": "Two-Stage Scaffolding Architecture",
        "status": "accepted",
        "anchor_id": "adr-0002",
        "index_updated": true
      },
      {
        "id": "ADR-0003",
        "title": "Agent Inheritance and Project Lifecycle Management",
        "status": "accepted",
        "anchor_id": "adr-0003",
        "index_updated": true
      },
      {
        "id": "ADR-0004",
        "title": "Beta Testing Improvements and Production Readiness",
        "status": "accepted",
        "anchor_id": "adr-0004",
        "index_updated": true
      }
    ],
    "index_entries": [
      {
        "id": "ADR-0012",
        "title": "[Migration Agent and Project Update Protocol](#adr-0012)",
        "date": "2025-10-16",
        "status": "Accepted",
        "supersedes": "‚Äî",
        "superseded_by": "‚Äî"
      },
      {
        "id": "ADR-0011",
        "title": "[Agent System Template Implementation (SCAFFOLD-012)](#adr-0011)",
        "date": "2025-10-16",
        "status": "Accepted",
        "supersedes": "‚Äî",
        "superseded_by": "‚Äî"
      },
      {
        "id": "ADR-0010",
        "title": "[ADR Separation Architecture (Mothership vs Project)](#adr-0010)",
        "date": "2025-10-16",
        "status": "Accepted",
        "supersedes": "‚Äî",
        "superseded_by": "‚Äî"
      },
      {
        "id": "ADR-0004",
        "title": "[Beta Testing Improvements and Production Readiness](#adr-0004)",
        "date": "2025-10-12",
        "status": "Accepted",
        "supersedes": "‚Äî",
        "superseded_by": "‚Äî"
      },
      {
        "id": "ADR-0003",
        "title": "[Agent Inheritance and Project Lifecycle Management](#adr-0003)",
        "date": "2024-09-12",
        "status": "Accepted",
        "supersedes": "‚Äî",
        "superseded_by": "‚Äî"
      },
      {
        "id": "ADR-0002",
        "title": "[Two-Stage Scaffolding Architecture](#adr-0002)",
        "date": "2024-09-12",
        "status": "Accepted",
        "supersedes": "‚Äî",
        "superseded_by": "‚Äî"
      },
      {
        "id": "ADR-0001",
        "title": "[Meta-Development Project Factory System](#adr-0001)",
        "date": "2024-09-12",
        "status": "Accepted",
        "supersedes": "‚Äî",
        "superseded_by": "‚Äî"
      }
    ]
  }
}
